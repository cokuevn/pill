<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <meta name="theme-color" content="#4096FF" />
        <meta name="description" content="Simple medication reminder app to help you never miss a dose" />
        
        <!-- PWA manifest -->
        <link rel="manifest" href="/manifest.json" />
        
        <!-- iOS Safari meta tags -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta name="apple-mobile-web-app-title" content="Pill Reminder" />
        <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNDA5NkZGIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xOCA5VjdBNCA0IDAgMCAwIDEwIDdWOUE0IDQgMCAwIDAgNiAxM1YxN0E0IDQgMCAwIDAgMTAgMjFIMTRBNCA0IDAgMCAwIDE4IDE3VjEzQTQgNCAwIDAgMCAxOCA5Wk0xMiA5SDE2VjdBNCA0IDAgMCAwIDggN1Y5SDEyWiIvPjwvc3ZnPg==" />
        
        <!-- Microsoft Tiles -->
        <meta name="msapplication-TileColor" content="#4096FF" />
        <meta name="msapplication-TileImage" content="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNDA5NkZGIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0xOCA5VjdBNCA0IDAgMCAwIDEwIDdWOUE0IDQgMCAwIDAgNiAxM1YxN0E0IDQgMCAwIDAgMTAgMjFIMTRBNCA0IDAgMCAwIDE4IDE3VjEzQTQgNCAwIDAgMCAxOCA5Wk0xMiA5SDE2VjdBNCA0IDAgMCAwIDggN1Y5SDEyWiIvPjwvc3ZnPg==" />
        
        <title>Simple Pill Reminder</title>
        
        <!-- Service Worker will be registered by React -->
    </head>
    <body>
        <noscript>JavaScript needs to be enabled for the app to work.</noscript>
        <div id="root"></div>
        
        <!-- PWA Install Prompt -->
        <script>
            // Global AdSense error handler - загружается ДО React
            window.addEventListener('error', function(event) {
                // Проверяем, связана ли ошибка с AdSense
                if (event.error && 
                    (event.error.message?.includes('adsbygoogle') || 
                     event.error.message?.includes('googlesyndication') ||
                     event.error.message?.includes('enable_page_level_ads') ||
                     event.error.stack?.includes('adsbygoogle'))) {
                    console.warn('⚠️ AdSense error caught early (expected until approved):', event.error.message);
                    event.preventDefault(); // Предотвращаем React error screen
                    event.stopPropagation();
                    return true;
                }
                return false;
            });
            
            // Обработчик для unhandled promise rejections
            window.addEventListener('unhandledrejection', function(event) {
                if (event.reason && 
                    (event.reason.message?.includes('adsbygoogle') || 
                     event.reason.message?.includes('googlesyndication') ||
                     event.reason.message?.includes('enable_page_level_ads'))) {
                    console.warn('⚠️ AdSense promise rejection caught early (expected until approved):', event.reason.message);
                    event.preventDefault(); // Предотвращаем React error screen
                    return true;
                }
                return false;
            });
            
            let deferredPrompt;
            let installPromptShown = false;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button after 10 seconds
                if (!installPromptShown) {
                    setTimeout(showInstallPrompt, 10000);
                }
            });
            
            function showInstallPrompt() {
                if (deferredPrompt && !installPromptShown) {
                    installPromptShown = true;
                    
                    const prompt = document.createElement('div');
                    prompt.className = 'pwa-install-prompt animate-slide-up';
                    prompt.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div>📱</div>
                            <div>
                                <div style="font-weight: 600; font-size: 14px;">Install App</div>
                                <div style="font-size: 12px; color: #6b7280;">For quick access</div>
                            </div>
                            <button onclick="installApp()" style="background: #4096FF; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600;">Install</button>
                            <button onclick="hideInstallPrompt()" style="background: none; border: none; color: #6b7280; font-size: 18px; padding: 4px;">×</button>
                        </div>
                    `;
                    
                    document.body.appendChild(prompt);
                    
                    // Auto hide after 10 seconds
                    setTimeout(() => {
                        if (prompt.parentNode) {
                            prompt.parentNode.removeChild(prompt);
                        }
                    }, 10000);
                }
            }
            
            window.installApp = async function() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                    hideInstallPrompt();
                }
            }
            
            window.hideInstallPrompt = function() {
                const prompt = document.querySelector('.pwa-install-prompt');
                if (prompt) {
                    prompt.parentNode.removeChild(prompt);
                }
            }
            
            // Track installation
            window.addEventListener('appinstalled', () => {
                console.log('PWA installed');
                deferredPrompt = null;
            });
        </script>
        
        <!-- Analytics placeholder -->
        <script>
            // Here will be Google Analytics or other analytics
            console.log('Pill Reminder PWA launched');
        </script>
    </body>
</html>